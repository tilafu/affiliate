<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
    <title data-i18n-title="editProfileTitle">Edit Profile</title>
    <meta name="csrf-token" content="t9EtiRskFKx5XpnOFvbrimp5ZgsKIg3UU1Ea1iDM">
    <link rel="shortcut icon" href="./assets/uploads/generals/favicon-665b8c8a863b91717275786.png">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -            // Wait a moment for the sidebar script to initialize, then refresh user data
            setTimeout(() => {
                if (typeof window.refreshSidebarUserData === 'function') {
                    window.refreshSidebarUserData();
                }
            }, 300);  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Legacy scripts for compatibility -->
    <script src="./assets/frontend/js/jquery.min.js"></script>
    <script charset="utf-8" src="./assets/frontend/shopva/dialog.min.js"></script>
    <script charset="utf-8" src="./assets/frontend/shopva/common.js"></script>
    <link rel="stylesheet" href="./assets/frontend/shopva/layer.css">
    <script src="./assets/frontend/shopva/layer.js"></script>
      <!-- Custom Profile Styles -->
    <style>
        :root {
            --primary-blue: #007AFF;
            --secondary-blue: #5AC8FA;
            --success-green: #30D158;
            --warning-orange: #FF9500;
            --danger-red: #FF3B30;
            --purple: #5856D6;
            --pink: #FF2D92;
            --background: #F2F2F7;
            --card-background: #FFFFFF;
            --text-primary: #000000;
            --text-secondary: #8E8E93;
            --border-color: #E5E5EA;
            --shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .profile-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 24px 24px;
            box-shadow: var(--shadow-hover);
        }
        
        .profile-card {
            background: var(--card-background);
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            overflow: hidden;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .profile-card:hover {
            box-shadow: var(--shadow-hover);
        }
        
        .profile-item {
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .profile-item:last-child {
            border-bottom: none;
        }
        
        .profile-item:hover {
            background: var(--background);
        }
        
        .profile-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid var(--primary-blue);
            object-fit: cover;
            box-shadow: var(--shadow);
        }
        
        .profile-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 14px;
        }
        
        .profile-value {
            color: var(--text-secondary);
            margin-bottom: 0;
            font-size: 16px;
            font-weight: 500;
        }
        
        .btn-custom {
            background: var(--primary-blue);
            border: none;
            border-radius: 20px;
            padding: 0.75rem 1.5rem;
            color: white;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-custom:hover {
            background: var(--secondary-blue);
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
            color: white;
        }
          .btn-password {
            background: transparent;
            border: 2px solid var(--primary-blue);
            border-radius: 20px;
            color: var(--primary-blue);
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            font-weight: 600;
            font-size: 14px;
        }
        
        .btn-password:hover {
            background: var(--primary-blue);
            color: white;
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
        }
        
        .modal-content {
            border-radius: 20px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-hover);
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            border-radius: 20px 20px 0 0;
            border-bottom: none;
        }
        
        .modal-header .btn-close {
            filter: invert(1);
        }
        
        .form-control {
            border-radius: 12px;
            border: 2px solid var(--border-color);
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
            background: var(--card-background);
            color: var(--text-primary);
        }
        
        .form-control:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
            outline: none;
        }
        
        .icon-circle {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            margin-right: 1rem;
            box-shadow: var(--shadow);
        }
          .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }          .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            transform: translateY(-1px);
        }

        .menu-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .menu-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            transform: translateY(-1px);
        }

        /* Sidebar Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Responsive sidebar styles */
        @media (max-width: 768px) {
            .main-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .main-sidebar.active {
                transform: translateX(0);
            }
        }
    </style>
</head>
<body>

<div class="bg-overlay navbar-btn"></div>

<!-- Sidebar -->
<div id="sidebar-container"></div>

<!-- Sidebar Overlay -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Modern Profile Header -->
<div class="profile-header">
    <div class="container">
        <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-3">
                <button class="menu-btn" id="menuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <a href="javascript:history.back()" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="text-center flex-grow-1">
                <h2 class="mb-0 fw-bold" data-i18n="editProfileTitle">Edit Profile</h2>
                <p class="mb-0 opacity-75">Manage your account information</p>
            </div>
            <div style="width: 90px;"></div> <!-- Spacer for alignment -->
        </div>
    </div>
</div>

<main class="main-content">
    <div class="container">
        <!-- Profile Information Card -->
        <div class="profile-card">
            <!-- Profile Image Section -->
            <div class="profile-item">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <div class="profile-label" data-i18n="profileImageLabel">Profile Image</div>
                            <small class="text-muted">Update your profile picture</small>
                        </div>
                    </div>
                    <img src="./assets/uploads/user.jpg" class="profile-image" alt="Profile Picture">
                </div>
            </div>

            <!-- Username Section -->
            <div class="profile-item">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle">
                            <i class="fas fa-id-card"></i>
                        </div>
                        <div>
                            <div class="profile-label" data-i18n="usernameLabel">Username</div>
                            <small class="text-muted">Your unique identifier</small>
                        </div>
                    </div>
                    <div class="text-end">
                        <span class="profile-value fw-semibold" id="profile-username">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- Mobile Number Section -->
            <div class="profile-item">
                <div class="row align-items-center">
                    <div class="col-12 col-md-7">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div>
                                <div class="profile-label" data-i18n="mobileNumberLabel">Mobile Number</div>
                                <small class="text-muted">Used for account verification</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-5 mt-3 mt-md-0">
                        <div class="d-flex gap-2">
                            <input type="tel" id="profile-mobile-input" class="form-control flex-grow-1" value="Loading..." placeholder="Enter mobile number">
                            <button id="profile-save-btn" class="btn btn-custom" data-i18n="saveButton">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Registration Date Section -->
            <div class="profile-item">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div>
                            <div class="profile-label" data-i18n="registrationDateLabel">Registration Date</div>
                            <small class="text-muted">When you joined us</small>
                        </div>
                    </div>
                    <div class="text-end">
                        <span class="profile-value fw-semibold" id="profile-registration-date">Loading...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Password Management Card -->
        <div class="profile-card">
            <div class="profile-item">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle">
                            <i class="fas fa-lock"></i>
                        </div>
                        <div>
                            <div class="profile-label" data-i18n="withdrawPasswordLabel">Withdraw Password</div>
                            <small class="text-muted">Secure your withdrawals</small>
                        </div>
                    </div>
                    <button type="button" class="btn-password" data-bs-toggle="modal" data-bs-target="#changeWithdrawPasswordModal">
                        Change <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>

            <div class="profile-item">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle">
                            <i class="fas fa-key"></i>
                        </div>
                        <div>
                            <div class="profile-label" data-i18n="loginPasswordLabel">Login Password</div>
                            <small class="text-muted">Your account access password</small>
                        </div>
                    </div>
                    <button type="button" class="btn-password" data-bs-toggle="modal" data-bs-target="#changeLoginPasswordModal">
                        Change <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>
        </div>    <!-- Enhanced Modals for Password Change -->
    <!-- Login Password Modal -->
    <div class="modal fade" id="changeLoginPasswordModal" tabindex="-1" aria-labelledby="changeLoginPasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" id="changeLoginPasswordModalLabel" data-i18n="changeLoginPasswordModalTitle">Change Login Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="icon-circle mx-auto mb-3" style="width: 80px; height: 80px; font-size: 2rem;">
                            <i class="fas fa-key"></i>
                        </div>
                        <p class="text-muted">Update your login password to keep your account secure</p>
                    </div>
                    <form id="loginPasswordForm">
                        <div class="mb-4">
                            <label for="currentLoginPassword" class="form-label fw-semibold" data-i18n="currentPasswordLabel">Current Password</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-2" style="border-color: #e9ecef; border-radius: 12px 0 0 12px;">
                                    <i class="fas fa-lock text-muted"></i>
                                </span>
                                <input type="password" class="form-control border-start-0" id="currentLoginPassword" required style="border-radius: 0 12px 12px 0;">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="newLoginPassword" class="form-label fw-semibold" data-i18n="newPasswordLabel">New Password</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-2" style="border-color: #e9ecef; border-radius: 12px 0 0 12px;">
                                    <i class="fas fa-key text-muted"></i>
                                </span>
                                <input type="password" class="form-control border-start-0" id="newLoginPassword" required style="border-radius: 0 12px 12px 0;">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="confirmNewLoginPassword" class="form-label fw-semibold" data-i18n="confirmNewPasswordLabel">Confirm New Password</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-2" style="border-color: #e9ecef; border-radius: 12px 0 0 12px;">
                                    <i class="fas fa-check text-muted"></i>
                                </span>
                                <input type="password" class="form-control border-start-0" id="confirmNewLoginPassword" required style="border-radius: 0 12px 12px 0;">
                            </div>
                        </div>
                        <div id="loginPasswordError" class="alert alert-danger d-none" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <span></span>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal" data-i18n="closeButton" style="border-radius: 25px; padding: 0.75rem 1.5rem;">Cancel</button>
                    <button type="button" class="btn btn-custom" id="submitLoginPasswordChange" data-i18n="saveChangesButton">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdraw Password Modal -->
    <div class="modal fade" id="changeWithdrawPasswordModal" tabindex="-1" aria-labelledby="changeWithdrawPasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" id="changeWithdrawPasswordModalLabel" data-i18n="changeWithdrawPasswordModalTitle">Change Withdraw Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="icon-circle mx-auto mb-3" style="width: 80px; height: 80px; font-size: 2rem;">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <p class="text-muted mb-2">Secure your withdrawal transactions</p>
                        <div class="alert alert-info" role="alert" style="border-radius: 12px;">
                            <i class="fas fa-info-circle me-2"></i>
                            <small data-i18n="withdrawPasswordDefaultText">If not set, the withdrawal password defaults to your login password.</small>
                        </div>
                    </div>
                    <form id="withdrawPasswordForm">
                        <div class="mb-4">
                            <label for="currentWithdrawPassword" class="form-label fw-semibold" data-i18n="currentPasswordLoginPasswordLabel">Current Password (Login Password)</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-2" style="border-color: #e9ecef; border-radius: 12px 0 0 12px;">
                                    <i class="fas fa-lock text-muted"></i>
                                </span>
                                <input type="password" class="form-control border-start-0" id="currentWithdrawPassword" required style="border-radius: 0 12px 12px 0;">
                            </div>
                            <small class="text-muted mt-1" data-i18n="currentLoginPasswordVerificationText">Enter your current login password to verify.</small>
                        </div>
                        <div class="mb-4">
                            <label for="newWithdrawPassword" class="form-label fw-semibold" data-i18n="newWithdrawPasswordLabel">New Withdraw Password</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-2" style="border-color: #e9ecef; border-radius: 12px 0 0 12px;">
                                    <i class="fas fa-key text-muted"></i>
                                </span>
                                <input type="password" class="form-control border-start-0" id="newWithdrawPassword" required style="border-radius: 0 12px 12px 0;">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="confirmNewWithdrawPassword" class="form-label fw-semibold" data-i18n="confirmNewWithdrawPasswordLabel">Confirm New Withdraw Password</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-2" style="border-color: #e9ecef; border-radius: 12px 0 0 12px;">
                                    <i class="fas fa-check text-muted"></i>
                                </span>
                                <input type="password" class="form-control border-start-0" id="confirmNewWithdrawPassword" required style="border-radius: 0 12px 12px 0;">
                            </div>
                        </div>
                        <div id="withdrawPasswordError" class="alert alert-danger d-none" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <span></span>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal" data-i18n="closeButton" style="border-radius: 25px; padding: 0.75rem 1.5rem;">Cancel</button>
                    <button type="button" class="btn btn-custom" id="submitWithdrawPasswordChange" data-i18n="saveChangesButton">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    <!-- End Enhanced Modals -->    </div>
</main>

<!-- Standard Footer Navigation -->
<div id="footer-navigation"></div>

<script>let baseurl = '.';</script> <!-- Use relative base URL -->

<!-- Bootstrap 5 JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<!-- Important: i18n.js must be loaded before other scripts -->
<script src="./js/i18n.js"></script>
<!-- i18n initialization is now handled automatically by i18n.js -->
<script>
    // i18n system is now simplified and initializes automatically
    console.log('i18n system loaded (using fallback text conversion)');
</script>
<script src="./js/components.js"></script>
<script src="./js/main.js"></script> <!-- Contains fetchWithAuth, etc. -->
<script src="./js/auth-check.js"></script> <!-- Centralized authentication -->
<script src="./js/profile.js"></script> <!-- Script for this page -->

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Load standard navigation components
    loadStandardNavigation();
    
    // Initialize menu functionality
    initializeMenuControls();
});

// Load sidebar component
async function loadSidebarComponent() {
    try {
        const response = await fetch('./components/sidebar.html');
        if (response.ok) {
            const sidebarHTML = await response.text();
            document.getElementById('sidebar-container').innerHTML = sidebarHTML;
            
            // Wait a moment for the sidebar script to initialize, then refresh user data
            setTimeout(() => {
                if (typeof window.refreshSidebarUserData === 'function') {
                    window.refreshSidebarUserData();
                }
            }, 100);
        }
    } catch (error) {
        console.error('Error loading sidebar:', error);
    }
}

// Initialize menu controls
function initializeMenuControls() {
    // Handle menu button clicks (delegated event handling)
    document.addEventListener('click', function(e) {
        if (e.target.matches('#menuBtn') || e.target.closest('#menuBtn')) {
            const sidebar = document.querySelector('.main-sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (sidebar && overlay) {
                sidebar.classList.add('active');
                overlay.classList.add('active');
            }
        }
        
        if (e.target.matches('#sidebar-close-button') || e.target.closest('#sidebar-close-button')) {
            const sidebar = document.querySelector('.main-sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (sidebar && overlay) {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            }
        }
        
        if (e.target.matches('#sidebarOverlay')) {
            const sidebar = document.querySelector('.main-sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (sidebar && overlay) {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            }
        }
    });
}
</script>
</body>
</html>
