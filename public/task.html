<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
    <title data-i18n-title="taskPageTitle">Task</title>
    <meta name="csrf-token" content="OMQEMMbTOijuw7VQQjJ3OJfRh0OxIoBZVH9aGGDe">
    <link rel="shortcut icon" href="./assets/uploads/generals/favicon-665b8c8a863b91717275786.png">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Legacy scripts for compatibility -->
    <script src="./assets/frontend/js/jquery.min.js"></script>
    <script charset="utf-8" src="./assets/frontend/shopva/dialog.min.js"></script>
    <script charset="utf-8" src="./assets/frontend/shopva/common.js"></script>
    <link rel="stylesheet" href="./assets/frontend/shopva/layer.css">
    <script src="./assets/frontend/shopva/layer.js"></script>
    <!-- Custom CSS for shared styles -->
    <link rel="stylesheet" href="css/task-account-styles.css">
</head>
<body>

<div class="bg-overlay navbar-btn"></div>
<!-- Sidebar Placeholder -->
<div id="sidebar-placeholder"></div>
<!-- End Sidebar Placeholder -->

<!-- Modern Task Header -->
<header class="page-header">
    <div class="container">
        <div class="d-flex align-items-center justify-content-between">
            <a href="javascript:history.back()" class="back-btn">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div class="text-center flex-grow-1">
                <h1 data-i18n="taskPageTitle">Task Center</h1>
                <p class="subtitle">Complete tasks and earn rewards</p>
            </div>
            <div style="width: 44px;"></div> <!-- Spacer for alignment -->
        </div>
    </div>
</header>

<main class="main-content">
    <div class="container">        <!-- Dashboard Stats -->
        <div class="stats-grid">
            <div class="app-card animate-fade-in-up enhanced-hover">
                <div class="stat-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Wallet Balance</div>
                    <div class="stat-value">
                        <span class="datadrive-balance">Loading...</span>
                    </div>
                </div>
                <button id="refresh-drive-button" class="stat-refresh rotate-on-hover" title="Refresh Balance">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            
            <div class="app-card animate-fade-in-up enhanced-hover">
                <div class="stat-icon success">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Commission Earned</div>
                    <div class="stat-value gradient-text">
                        <span class="datadrive-commission">0.00 USDT</span>
                    </div>
                </div>
            </div>
            
            <div class="app-card animate-fade-in-up enhanced-hover">
                <div class="stat-icon warning">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Tasks Completed</div>
                    <div class="stat-value">
                        <span id="tasks-count">0 / 45</span>
                    </div>
                </div>
            </div>
        </div>        <!-- Progress Section -->
        <div class="progress-section animate-slide-in-right">
            <div class="app-card enhanced-hover">
                <div class="progress-header">
                    <h3 class="text-shadow">Drive Progress</h3>
                    <span id="progress-text" class="progress-status">Drive starting...</span>
                </div>
                <div class="modern-progress">
                    <div id="drive-progress-bar" class="progress-fill glow" style="width: 0%"></div>
                </div>
            </div>
        </div>        <!-- Task Controls -->
        <div class="task-controls animate-bounce-in">
            <input type="hidden" name="user_status" id="user_status" value="1">
            <button class="btn-modern btn-primary btn-lg enhanced-focus pulse" id="autoStart">
                <i class="fas fa-play"></i>
                <span>Start Tasks</span>
                <div class="btn-shine"></div>
            </button>
            <a href="./orders.html" class="btn-modern btn-secondary btn-lg enhanced-focus">
                <i class="fas fa-list"></i>
                <span>View Records</span>
                <div class="btn-shine"></div>
            </a>
        </div>        <!-- Product Display Section (hidden by default) -->
        <div class="product-section animate-fade-in-up" id="product-card-container" style="display: none;">
            <div class="product-preview glass-card" id="order-loading-overlay" style="display: none;">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading next product...</p>
            </div>
            
            <div class="product-card enhanced-hover float" id="product-display">
                <div class="product-image-container">
                    <img id="product-image" src="" alt="Product Image" class="product-image">
                    <div class="product-overlay">
                        <button class="btn-view-product enhanced-focus" onclick="openProductModal()">
                            <i class="fas fa-eye"></i>
                            View Details
                        </button>
                    </div>
                </div>
                <div class="product-info">
                    <h3 id="product-name" class="product-title gradient-text text-shadow">Product Name</h3>
                    <div class="product-stats">
                        <div class="product-stat">
                            <span class="stat-label">Commission</span>
                            <span id="product-commission" class="stat-value gradient-text">0.00 USDT</span>
                        </div>
                        <div class="product-stat">
                            <span class="stat-label">Price</span>
                            <span id="product-price" class="stat-value">$0.00</span>
                        </div>
                    </div>
                    <button id="purchase-button" class="btn-modern btn-success btn-lg enhanced-focus">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Purchase Now</span>
                        <div class="btn-shine"></div>
                    </button>
                </div>
            </div>
        </div>        <!-- Information Cards -->
        <div class="info-cards">
            <div class="info-card enhanced-hover animate-fade-in-up">
                <div class="info-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="info-content">
                    <h4 class="text-shadow">Operating Hours</h4>
                    <p>10:00 AM - 11:00 PM daily</p>
                </div>
            </div>
            
            <div class="info-card enhanced-hover animate-fade-in-up">
                <div class="info-icon warning">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="info-content">
                    <h4 class="text-shadow">Important Notice</h4>
                    <p>System pauses product distribution during non-operating hours</p>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Full-Screen Product Modal -->
<div class="product-modal" id="product-modal">
    <div class="product-modal-content">
        <div class="product-modal-header">
            <button class="modal-close" onclick="closeProductModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="product-modal-body">
            <div class="product-grid"> <!-- Added product-grid wrapper -->
                <div class="product-image-section"> <!-- Renamed from modal-product-image -->
                    <img id="modal-product-image" src="" alt="Product Image" class="product-image">
                </div>
                
                <div class="product-details-section"> <!-- Renamed from modal-product-details -->
                    <div class="product-badge">Featured Product</div>
                    <h2 id="modal-product-name" class="product-title">Product Name</h2> <!-- Changed class to product-title -->
                    <p id="modal-product-description" class="modal-product-description">
                        Detailed product description will be displayed here with all the features and benefits.
                    </p>
                    
                    <div class="modal-product-stats">
                        <div class="modal-stat-card">
                            <div class="modal-stat-icon">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="modal-stat-content">
                                <span class="modal-stat-label">Price</span>
                                <span id="modal-product-price" class="modal-stat-value">$0.00</span>
                            </div>
                        </div>
                        
                        <div class="modal-stat-card success">
                            <div class="modal-stat-icon">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="modal-stat-content">
                                <span class="modal-stat-label">Commission</span>
                                <span id="modal-product-commission" class="modal-stat-value">0.00 USDT</span>
                            </div>
                        </div>
                        
                        <div class="modal-stat-card warning">
                            <div class="modal-stat-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="modal-stat-content">
                                <span class="modal-stat-label">Commission Rate</span>
                                <span id="modal-commission-rate" class="modal-stat-value">0%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button id="modal-purchase-button" class="btn-modern btn-success btn-xl">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Complete Purchase</span>
                            <div class="btn-shine"></div>
                        </button>
                        <button class="btn-modern btn-secondary btn-xl" onclick="closeProductModal()">
                            <i class="fas fa-times"></i>
                            <span>Cancel</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Frozen Account -->
<div class="modal fade" id="frozenAccountModal" tabindex="-1" aria-labelledby="frozenAccountModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <div class="d-flex align-items-center">
          <div class="icon-circle bg-warning text-dark me-3">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div>
            <h5 class="modal-title mb-0" id="frozenAccountModalLabel">Account Temporarily Frozen</h5>
            <small class="text-muted">Action Required</small>
          </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning border-0 mb-4">
          <div class="d-flex align-items-start">
            <i class="fas fa-info-circle me-3 mt-1"></i>
            <div>
              <h6 class="alert-heading mb-2">Why is my account frozen?</h6>
              <p class="mb-0">Your account has been temporarily frozen due to insufficient balance during a drive operation. This is a protective measure to prevent negative balances.</p>
            </div>
          </div>
        </div>
        
        <div class="mb-4">
          <h6 class="fw-bold mb-3">Current Status:</h6>
          <div class="row">
            <div class="col-md-6">
              <div class="border rounded p-3 text-center">
                <i class="fas fa-wallet text-primary mb-2 d-block" style="font-size: 1.5rem;"></i>
                <small class="text-muted d-block">Available Balance</small>
                <strong id="modal-current-balance" class="text-primary">Loading...</strong>
              </div>
            </div>
            <div class="col-md-6">
              <div class="border rounded p-3 text-center">
                <i class="fas fa-dollar-sign text-success mb-2 d-block" style="font-size: 1.5rem;"></i>
                <small class="text-muted d-block">Amount Needed</small>
                <strong id="modal-amount-needed" class="text-success">Calculating...</strong>
              </div>
            </div>
          </div>
        </div>
        
        <div class="bg-light rounded p-3 mb-4">
          <h6 class="fw-bold mb-2">
            <i class="fas fa-lightbulb text-warning me-2"></i>
            How to resolve this:
          </h6>
          <ol class="mb-0 ps-3">
            <li>Make a deposit to add funds to your account</li>
            <li>Wait for the deposit to be confirmed</li>
            <li>Your account will be automatically unfrozen once sufficient funds are available</li>
            <li>If the issue persists, contact our support team</li>
          </ol>
        </div>
        
        <div class="text-center">
          <p class="text-muted mb-0">
            <i class="fas fa-shield-alt me-1"></i>
            Your account security and funds are protected during this process.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light" data-bs-dismiss="modal">I'll Handle This Later</button>
        <a href="deposits.html" class="btn btn-warning">
          <i class="fas fa-plus-circle me-2"></i>Make Deposit
        </a>
        <a href="support.html" class="btn btn-custom">
          <i class="fas fa-headset me-2"></i>Contact Support
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Modern Footer -->
<footer class="bg-white border-top mt-5">
    <div class="container">
        <div class="footer-bar py-3">
            <div class="d-flex justify-content-around align-items-center">
                <a href="./dashboard.html" class="footer-link text-decoration-none">
                    <div class="text-center">
                        <div class="footer-icon mb-1">
                            <svg viewBox="0 1 511 511.999" width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="m498.699219 222.695312c-.015625-.011718-.027344-.027343-.039063-.039062l-208.855468-208.847656c-8.902344-8.90625-20.738282-13.808594-33.328126-13.808594-12.589843 0-24.425781 4.902344-33.332031 13.808594l-208.746093 208.742187c-.070313.070313-.144532.144531-.210938.214844-18.28125 18.386719-18.25 48.21875.089844 66.558594 8.378906 8.382812 19.441406 13.234375 31.273437 13.746093.484375.046876.96875.070313 1.457031.070313h8.320313v153.695313c0 30.417968 24.75 55.164062 55.167969 55.164062h81.710937c8.285157 0 15-6.71875 15-15v-120.5c0-13.878906 11.292969-25.167969 25.171875-25.167969h48.195313c13.878906 0 25.167969 11.289063 25.167969 25.167969v120.5c0 8.28125 6.714843 15 15 15h81.710937c30.421875 0 55.167969-24.746094 55.167969-55.164062v-153.695313h7.71875c12.585937 0 24.421875-4.902344 33.332031-13.8125 18.359375-18.367187 18.367187-48.253906.027344-66.632813zm-21.242188 45.421876c-3.238281 3.238281-7.542969 5.023437-12.117187 5.023437h-22.71875c-8.285156 0-15 6.714844-15 15v168.695313c0 13.875-11.289063 25.164062-25.167969 25.164062h-66.710937v-105.5c0-30.417969-24.746094-55.167969-55.167969-55.167969h-48.195313c-30.421875 0-55.171875 24.75-55.171875 55.167969v105.5h-66.710937c-13.875 0-25.167969-11.289062-25.167969-25.164062v-168.695313c0-8.285156-6.714844-15-15-15h-22.328125c-.234375-.015625-.464844-.027344-.703125-.03125-4.46875-.078125-8.660156-1.851563-11.800781-4.996094-6.679688-6.679687-6.679688-17.550781 0-24.234375.003906 0 .003906-.003906.007812-.007812l.011719-.011719 208.847656-208.839844c3.234375-3.238281 7.535157-5.019531 12.113281-5.019531 4.574219 0 8.875 1.78125 12.113282 5.019531l208.800781 208.796875c.03125.03125.066406.0625.097656.09375 6.644531 6.691406 6.632813 17.539063-.03125 24.207032zm0 0"/>
                            </svg>
                        </div>
                        <small class="footer-text" data-i18n="footerHomeLink">Home</small>
                    </div>
                </a>
                <a href="./task.html" class="footer-link text-decoration-none active">
                    <div class="text-center">
                        <div class="footer-icon mb-1">
                            <svg fill="currentColor" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 469.341 469.341">
                                <path d="M448.004,236.639v-65.965c0-22.368-17.35-40.559-39.271-42.323l-61.26-107c-5.677-9.896-14.844-16.969-25.813-19.906c-10.917-2.917-22.333-1.385-32.104,4.302L79.553,128.007H42.67c-23.531,0-42.667,19.135-42.667,42.667v256c0,23.531,19.135,42.667,42.667,42.667h362.667c23.531,0,42.667-19.135,42.667-42.667v-65.965c12.389-4.418,21.333-16.147,21.333-30.035v-64C469.337,252.786,460.393,241.057,448.004,236.639z M383.944,128.007h-92.971l69.729-40.596L383.944,128.007z M350.103,68.898l-101.529,59.109h-42.113l133.112-77.5L350.103,68.898z M300.295,24.184c4.823-2.823,10.458-3.573,15.844-2.135c5.448,1.458,9.99,4.979,12.813,9.906l0.022,0.039l-164.91,96.013h-42.111L300.295,24.184z M426.67,426.674c0,11.76-9.573,21.333-21.333,21.333H42.67c-11.76,0-21.333-9.573-21.333-21.333v-256c0-11.76,9.573-21.333,21.333-21.333h362.667c11.76,0,21.333,9.573,21.333,21.333v64h-64c-35.292,0-64,28.708-64,64c0,35.292,28.708,64,64,64h64V426.674z M448.004,330.674c0,5.885-4.781,10.667-10.667,10.667H362.67c-23.531,0-42.667-19.135-42.667-42.667c0-23.531,19.135-42.667,42.667-42.667h74.667c5.885,0,10.667,4.781,10.667,10.667V330.674z"/>
                                <path d="M362.67,277.341c-11.76,0-21.333,9.573-21.333,21.333c0,11.76,9.573,21.333,21.333,21.333c11.76,0,21.333-9.573,21.333-21.333C384.004,286.914,374.431,277.341,362.67,277.341z"/>
                            </svg>
                        </div>
                        <small class="footer-text" data-i18n="footerStartingLink">Starting</small>
                    </div>
                </a>
                <a href="./account.html" class="footer-link text-decoration-none">
                    <div class="text-center">
                        <div class="footer-icon mb-1">
                            <svg viewBox="-42 0 512 512.001" width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="m210.351562 246.632812c33.882813 0 63.21875-12.152343 87.195313-36.128906 23.96875-23.972656 36.125-53.304687 36.125-87.191406 0-33.875-12.152344-63.210938-36.128906-87.191406-23.976563-23.96875-53.3125-36.121094-87.191407-36.121094-33.886718 0-63.21875 12.152344-87.191406 36.125s-36.128906 53.308594-36.128906 87.1875c0 33.886719 12.15625 63.222656 36.128906 87.195312 23.980469 23.96875 53.316406 36.125 87.191406 36.125zm-65.972656-189.292968c18.394532-18.394532 39.972656-27.335938 65.972656-27.335938 25.996094 0 47.578126 8.941406 65.976563 27.335938 18.394531 18.398437 27.339844 39.980468 27.339844 65.972656 0 26-8.945313 47.578125-27.339844 65.976562-18.398437 18.398438-39.980469 27.339844-65.976563 27.339844-25.992187 0-47.570312-8.945312-65.972656-27.339844-18.398437-18.394531-27.34375-39.976562-27.34375-65.976562 0-25.992188 8.945313-47.574219 27.34375-65.972656zm0 0"/>
                                <path d="m426.128906 393.703125c-.691406-9.976563-2.089844-20.859375-4.148437-32.351563-2.078125-11.578124-4.753907-22.523437-7.957031-32.527343-3.3125-10.339844-7.808594-20.550781-13.375-30.335938-5.769532-10.15625-12.550782-19-20.160157-26.277343-7.957031-7.613282-17.699219-13.734376-28.964843-18.199219-11.226563-4.441407-23.667969-6.691407-36.976563-6.691407-5.226563 0-10.28125 2.144532-20.042969 8.5-6.007812 3.917969-13.035156 8.449219-20.878906 13.460938-6.707031 4.273438-15.792969 8.277344-27.015625 11.902344-10.949219 3.542968-22.066406 5.339844-33.042969 5.339844-10.96875 0-22.085937-1.796876-33.042968-5.339844-11.210938-3.621094-20.300782-7.625-26.996094-11.898438-7.769532-4.964844-14.800782-9.496094-20.898438-13.46875-9.753906-6.355468-14.808594-8.5-20.035156-8.5-13.3125 0-25.75 2.253906-36.972656 6.699219-11.257813 4.457031-21.003906 10.578125-28.96875 18.199219-7.609375 7.28125-14.390625 16.121094-20.15625 26.273437-5.558594 9.785157-10.058594 19.992188-13.371094 30.339844-3.199219 10.003906-5.875 20.945313-7.953125 32.523437-2.0625 11.476563-3.457031 22.363282-4.148437 32.363282-.679688 9.777344-1.023438 19.953125-1.023438 30.234375 0 26.726562 8.496094 48.363281 25.25 64.320312 16.546875 15.746094 38.4375 23.730469 65.066406 23.730469h246.53125c26.621094 0 48.511719-7.984375 65.0625-23.730469 16.757813-15.945312 25.253906-37.589843 25.253906-64.324219-.003906-10.316406-.351562-20.492187-1.035156-30.242187zm-44.90625 72.828125c-10.933594 10.40625-25.449218 15.464844-44.378906 15.464844h-246.527344c-18.933594 0-33.449218-5.058594-44.378906-15.460938-10.722656-10.207031-15.933594-24.140625-15.933594-42.585937 0-9.59375.316406-19.066407.949219-28.160157.617187-8.921874 1.878906-18.722656 3.75-29.136718 1.847656-10.285156 4.199219-19.9375 6.996094-28.675782 2.683593-8.378906 6.34375-16.675781 10.882812-24.667968 4.332031-7.617188 9.316407-14.152344 14.816407-19.417969 5.144531-4.925781 11.628906-8.957031 19.269531-11.980469 7.066406-2.796875 15.007812-4.328125 23.628906-4.558594 1.050781.558594 2.921875 1.625 5.953125 3.601563 6.167969 4.019531 13.277344 8.605469 21.136719 13.625 8.859375 5.648437 20.273437 10.75 33.910156 15.152344 13.941406 4.507812 28.160156 6.796875 42.273437 6.796875 14.113282 0 28.335938-2.289063 42.269532-6.792969 13.648437-4.410156 25.058594-9.507813 33.929687-15.164063 8.042969-5.140624 14.953125-9.59375 21.121094-13.617187 3.03125-1.972656 4.902344-3.042969 5.953125-3.601563 8.625.230469 16.566406 1.761719 23.636719 4.558594 7.636719 3.023438 14.121093 7.058594 19.265625 11.980469 5.5 5.261719 10.484375 11.796875 14.816406 19.421875 4.542969 7.988281 8.207031 16.289062 10.886719 24.660156 2.800781 8.75 5.15625 18.398438 7 28.675782 1.867187 10.433593 3.132812 20.238281 3.75 29.144531v.007812c.636719 9.058594.957031 18.527344.960937 28.148438-.003906 18.449219-5.214844 32.378906-15.9375 42.582031zm0 0"/>
                            </svg>
                        </div>
                        <small class="footer-text" data-i18n="footerAccountLink">Account</small>
                    </div>
                </a>
            </div>
        </div>
    </div>
</footer>

<script>let baseurl = '.';</script> <!-- Use relative base URL -->

<script src="./assets/frontend/js/bootstrap.bundle.min.js"></script>

<!-- Owl Carousel JS - Using both CDN and local fallback -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<script>
    // If CDN fails, load from node_modules
    if (typeof $.fn.owlCarousel === 'undefined') {
        document.write('<script src="../node_modules/owl.carousel/dist/owl.carousel.min.js"><\/script>');
    }
</script>

<!-- Load general site script (uses jQuery) -->
<script src="./assets/frontend/js/script.js"></script>

<!-- Important: i18n.js must be loaded before other scripts -->
<script src="./js/i18n.js"></script>

<!-- Load Component Loader -->
<script src="./js/components.js"></script>
<script src="./js/dashboard.js"></script>

<!-- Session data management -->
<script src="./js/session-data.js"></script>

<!-- Load Helper/Auth Scripts -->
<script src="./js/main.js"></script>
<script src="./js/auth-check.js"></script> <!-- Centralized authentication -->

<!-- Withdrawable balance -->
<script src="./js/task.js"></script>

<script src="./js/auth.js"></script>

<!-- Product Modal Functions -->
<script>
// Product Modal Functions
function openProductModal() {
    const modal = document.getElementById('product-modal');
    const productImage = document.getElementById('product-image');
    const productName = document.getElementById('product-name');
    const productPrice = document.getElementById('product-price');
    const productCommission = document.getElementById('product-commission');
    
    // Copy data to modal
    document.getElementById('modal-product-image').src = productImage.src;
    document.getElementById('modal-product-name').textContent = productName.textContent;
    document.getElementById('modal-product-price').textContent = productPrice.textContent;
    document.getElementById('modal-product-commission').textContent = productCommission.textContent;
    
    // Calculate commission rate (placeholder calculation)
    const price = parseFloat(productPrice.textContent.replace('$', ''));
    const commission = parseFloat(productCommission.textContent.replace(' USDT', ''));
    const rate = price > 0 ? ((commission / price) * 100).toFixed(1) : 0;
    document.getElementById('modal-commission-rate').textContent = rate + '%';
    
    // Show modal
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
    
    // Set up modal purchase button
    const modalPurchaseBtn = document.getElementById('modal-purchase-button');
    const originalPurchaseBtn = document.getElementById('purchase-button');
    
    modalPurchaseBtn.onclick = function() {
        // Trigger the original purchase logic
        if (originalPurchaseBtn.onclick) {
            originalPurchaseBtn.onclick();
        } else if (originalPurchaseBtn.click) {
            originalPurchaseBtn.click();
        }
        closeProductModal();
    };
}

function closeProductModal() {
    const modal = document.getElementById('product-modal');
    modal.classList.remove('show');
    document.body.style.overflow = '';
}

// Close modal when clicking outside
document.getElementById('product-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeProductModal();
    }
});

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeProductModal();
    }
});

// Enhanced button animations
document.addEventListener('DOMContentLoaded', function() {
    // Initialize animation observer
    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                entry.target.style.animationPlayState = 'running';
            }
        });
    });

    // Observe animated elements
    document.querySelectorAll('.animate-fade-in-up, .animate-slide-in-right, .animate-bounce-in').forEach((el) => {
        el.style.animationPlayState = 'paused';
        observer.observe(el);
    });

    // Add ripple effect to buttons
    const buttons = document.querySelectorAll('.btn-modern');
    buttons.forEach(button => {
        button.addEventListener('click', function(e) {
            // Remove existing ripples
            const existingRipples = button.querySelectorAll('.ripple');
            existingRipples.forEach(ripple => ripple.remove());
            
            const ripple = document.createElement('span');
            ripple.classList.add('ripple');
            
            const rect = button.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            
            button.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 600);
        });
    });
    
    // Refresh button animation
    const refreshBtn = document.getElementById('refresh-drive-button');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            const icon = this.querySelector('i');
            icon.classList.add('rotate-on-hover');
            icon.style.animation = 'spin 1s linear';
            setTimeout(() => {
                icon.style.animation = '';
                icon.classList.remove('rotate-on-hover');
            }, 1000);
        });
    }

    // Add smooth scrolling to all links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Add loading skeleton effect
    function showLoadingSkeleton(element) {
        element.classList.add('loading-skeleton');
        element.textContent = 'Loading...';
    }

    function hideLoadingSkeleton(element, content) {
        element.classList.remove('loading-skeleton');
        element.textContent = content;
    }

    // Progress bar animation enhancement
    function animateProgressBar(element, targetWidth, duration = 1000) {
        const startWidth = parseFloat(element.style.width) || 0;
        const difference = targetWidth - startWidth;
        const startTime = performance.now();

        function updateProgress(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // Use easing function for smooth animation
            const easeOutCubic = 1 - Math.pow(1 - progress, 3);
            const currentWidth = startWidth + (difference * easeOutCubic);
            
            element.style.width = currentWidth + '%';
            
            if (progress < 1) {
                requestAnimationFrame(updateProgress);
            }
        }
        
        requestAnimationFrame(updateProgress);
    }

    // Add parallax effect to floating elements
    window.addEventListener('scroll', function() {
        const scrolled = window.pageYOffset;
        const parallaxElements = document.querySelectorAll('.float');
        
        parallaxElements.forEach((element, index) => {
            const speed = 0.5 + (index * 0.1);
            const yPos = -(scrolled * speed);
            element.style.transform = `translateY(${yPos}px)`;
        });
    });

    // Add auto-hide notification for long messages
    function showNotificationWithAutoHide(message, type = 'info', duration = 5000) {
        // Assuming showNotification function exists
        if (typeof showNotification === 'function') {
            showNotification(message, type);
            
            // Auto-hide after duration
            setTimeout(() => {
                const notifications = document.querySelectorAll('.notification, .alert');
                notifications.forEach(notification => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                });
            }, duration);
        }
    }

    // Add keyboard navigation support
    document.addEventListener('keydown', function(e) {
        // ESC key functionality
        if (e.key === 'Escape') {
            // Close any open modals
            const modals = document.querySelectorAll('.product-modal.show');
            modals.forEach(modal => {
                if (typeof closeProductModal === 'function') {
                    closeProductModal();
                }
            });
        }
        
        // Enter key on buttons
        if (e.key === 'Enter' && e.target.classList.contains('btn-modern')) {
            e.target.click();
        }
    });

    // Enhance form validation with real-time feedback
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const inputs = form.querySelectorAll('input, select, textarea');
            let isValid = true;
            
            inputs.forEach(input => {
                if (input.hasAttribute('required') && !input.value.trim()) {
                    input.classList.add('is-invalid');
                    isValid = false;
                } else {
                    input.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                showNotificationWithAutoHide('Please fill in all required fields', 'error');
            }
        });
    });

    // Add dynamic favicon update based on activity
    function updateFavicon(active = false) {
        const link = document.querySelector('link[rel="shortcut icon"]');
        if (link && active) {
            // Could add different favicon for active state
            link.href = link.href; // Refresh current favicon
        }
    }

    // Performance monitoring and optimization
    function optimizePerformance() {
        // Lazy load images
        const images = document.querySelectorAll('img[data-src]');
        const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.removeAttribute('data-src');
                    imageObserver.unobserve(img);
                }
            });
        });
        
        images.forEach(img => imageObserver.observe(img));
        
        // Preload critical resources
        const criticalResources = [
            './css/task-account-styles.css',
            './js/task.js'
        ];
        
        criticalResources.forEach(resource => {
            const link = document.createElement('link');
            link.rel = 'preload';
            link.href = resource;
            link.as = resource.includes('.css') ? 'style' : 'script';
            document.head.appendChild(link);
        });
    }
    
    // Initialize performance optimizations
    optimizePerformance();
    
    // Add connection status indicator
    function updateConnectionStatus() {
        const indicator = document.createElement('div');
        indicator.id = 'connection-status';
        indicator.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
        `;
        
        function updateStatus() {
            if (navigator.onLine) {
                indicator.textContent = 'ðŸŸ¢ Online';
                indicator.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                indicator.style.color = 'white';
            } else {
                indicator.textContent = 'ðŸ”´ Offline';
                indicator.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                indicator.style.color = 'white';
            }
        }
        
        updateStatus();
        document.body.appendChild(indicator);
        
        window.addEventListener('online', updateStatus);
        window.addEventListener('offline', updateStatus);
        
        // Auto-hide after 3 seconds if online
        setTimeout(() => {
            if (navigator.onLine) {
                indicator.style.opacity = '0';
                setTimeout(() => indicator.remove(), 300);
            }
        }, 3000);
    }
    
    // Initialize connection status
    updateConnectionStatus();
});
</script>

<!-- Initialize Owl Carousel -->
<!-- Removed Owl Carousel initialization as it's not used in the current HTML structure -->
</body>
</html>